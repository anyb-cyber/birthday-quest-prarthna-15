<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Happy Birthday Prarthna</title>
    <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Special+Elite&family=Rock+Salt&family=Satisfy&display=swap" rel="stylesheet">
    
    <style>
        body { margin: 0; background: #0a0a0a; overflow: hidden; font-family: 'Segoe UI', Tahoma, sans-serif; }
        canvas { display: block; background: #1a3317; cursor: none; }
        
        /* --- HOMEPAGE --- */
        #splash-screen {
            position: absolute; width: 100%; height: 100%; 
            background: #121212; display: flex; flex-direction: column; 
            justify-content: center; align-items: center; z-index: 2000;
        }
        .bday-title { font-family: 'Satisfy'; font-size: 45px; color: #d4af37; margin-bottom: 20px; text-shadow: 0 0 15px rgba(212, 175, 55, 0.4); }
        .collage-line { display: flex; flex-direction: row; justify-content: center; align-items: center; white-space: nowrap; margin-bottom: 50px; }
        .collage-letter {
            width: 75px; height: 95px; margin: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 55px; font-weight: bold; border: 2px solid #d4af37; box-shadow: 0 0 20px rgba(212, 175, 55, 0.2); 
        }
        .c1 { background: #4a0404; color: #d4af37; font-family: 'Permanent Marker'; transform: rotate(-4deg); }
        .c2 { background: #0b090a; color: #f5f3f4; font-family: 'Special Elite'; transform: rotate(3deg); border: 1px solid #d4af37;}
        .c3 { background: #d4af37; color: #000; font-family: 'Rock Salt'; font-size: 35px; transform: rotate(-2deg); }
        .c4 { background: #161a1d; color: #e63946; font-family: 'Satisfy'; transform: rotate(5deg); }
        .c5 { background: #000; color: #d4af37; font-family: 'Permanent Marker'; transform: rotate(-3deg); border: 1px double #d4af37; }
        .c6 { background: #660708; color: #fff; font-family: 'Special Elite'; transform: rotate(4deg); }
        .c7 { background: #f5f3f4; color: #660708; font-family: 'Rock Salt'; transform: rotate(-5deg); }
        .c8 { background: #a4161a; color: #d4af37; font-family: 'Satisfy'; transform: rotate(2deg); }

        /* MODALS */
        .modal-overlay {
            position: absolute; width: 100%; height: 100%; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; justify-content: center; align-items: center; z-index: 3000; color: white; text-align: center;
        }
        .briefing-box { background: #fffcf2; color: #252422; padding: 40px; border-radius: 15px; max-width: 500px; border: 5px double #660708; font-family: 'Special Elite'; }

        /* END SCREEN - UPDATED FOR LARGE IMAGES */
        #end-screen { background: linear-gradient(to bottom, #1a1a1a, #000); overflow-y: auto; display: none; padding: 40px 20px; }
        .photo-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            width: 90%; 
            max-width: 1200px;
            margin: 30px auto; 
        }
        .photo-grid img { 
            width: 100%; 
            max-height: 300px; 
            object-fit: contain; 
            background: #000;
            border: 3px solid #d4af37; 
            border-radius: 10px; 
        }

        #start-btn, .action-btn {
            padding: 15px 40px; font-size: 18px; cursor: pointer; margin-top: 20px;
            background: #252422; color: #d4af37; border: 2px solid #d4af37;
            font-family: 'Special Elite'; transition: 0.3s;
        }
        .action-btn:hover { background: #d4af37; color: black; }

        #mini-map-container {
            position: absolute; top: 25px; right: 25px; width: 150px; height: 150px;
            background: rgba(0,0,0,0.9); border: 2px solid white; z-index: 100;
            display: none; overflow: hidden; border-radius: 10px;
        }
        #ui { 
            position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); 
            width: 85%; max-width: 700px; background: white; padding: 30px; border-radius: 20px; display: none; 
            border: 6px solid #333; z-index: 1000;
        }
        #quest-tracker {
            position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.85); 
            padding: 20px; border-radius: 10px; border-left: 5px solid #ffed00; z-index: 100; display: none;
        }
    </style>
</head>
<body>

<div id="splash-screen">
    <div class="bday-title">Happy Birthday</div>
    <div class="collage-line">
        <div class="collage-letter c1">P</div><div class="collage-letter c2">R</div>
        <div class="collage-letter c3">A</div><div class="collage-letter c4">R</div>
        <div class="collage-letter c5">T</div><div class="collage-letter c6">H</div>
        <div class="collage-letter c7">N</div><div class="collage-letter c8">A</div>
    </div>
    <button id="start-btn" onclick="showBriefing(1)">OPEN FILE</button>
</div>

<div id="briefing-1" class="modal-overlay">
    <div class="briefing-box">
        <h2 style="color:#660708">MISSION BRIEFING</h2>
        <p>Your friends are hidden in the mystery garden.</p>
        <p>Use the <b>Radar Pulse</b> around you and the <b>Mini-Map</b> in the corner to find them.</p>
        <button class="action-btn" onclick="launchGame()">ACCEPT MISSION</button>
    </div>
</div>

<div id="briefing-2" class="modal-overlay">
    <div class="briefing-box">
        <h2 style="color:#660708">FINAL OBJECTIVE</h2>
        <p>All friends located! A celebration has been spotted at the heart of the garden.</p>
        <p>Follow the <b>Golden Glow</b> on your map to find the cake.</p>
        <button class="action-btn" onclick="closeCakeBriefing()">LET'S GO!</button>
    </div>
</div>

<div id="end-screen" class="modal-overlay">
    <h1 style="font-family: 'Satisfy'; font-size: 50px; color: #d4af37; margin: 0;">Mission Accomplished</h1>
    <div class="photo-grid">
        <img src="memory1.jpg" alt="Memory 1">
        <img src="memory2.jpg" alt="Memory 2">
        <img src="memory3.jpg" alt="Memory 3">
        <img src="memory4.jpg" alt="Memory 4">
    </div>
    <p style="font-family: 'Satisfy'; font-size: 24px; max-width: 600px; margin: 10px auto;">
        "To another year of being amazing. Happy 15th Birthday!"
    </p>
    <button class="action-btn" onclick="location.reload()">REPLAY GAME</button>
</div>

<div id="quest-tracker">
    <div id="quest-label" style="font-size: 11px; color: #ffed00; margin-bottom: 5px;">ACTIVE OBJECTIVE</div>
    <div id="quest-desc" style="font-size: 18px; font-weight: bold;">Find your 6 hidden guests.</div>
</div>

<div id="mini-map-container"><canvas id="mmCanvas" width="150" height="150"></canvas></div>
<canvas id="gameCanvas"></canvas>

<div id="ui">
    <h2 id="speaker-name" style="margin:0; color:#e63946; font-family: 'Permanent Marker';">???</h2>
    <hr>
    <div id="view-message">
        <img id="message-image" src="" style="width:100%; max-height:350px; object-fit:contain; display:none; border-radius:10px; margin-bottom: 10px;">
        <p id="message-text" style="font-size:20px; line-height: 1.5; color: #333;"></p>
        <button style="float:right" class="action-btn" onclick="showMemoryPhoto()">VIEW PHOTO &rarr;</button>
    </div>
    <div id="view-photo" style="display:none; text-align: center;">
        <img id="memory-image" src="" alt="Memory" style="width:100%; max-height:400px; border-radius:10px; margin-bottom:10px;">
        <button class="action-btn" onclick="closeDialog()">CONTINUE</button>
    </div>
</div>

<script>
const bgMusic = new Audio('https://assets.mixkit.co/music/preview/mixkit-beautiful-dream-493.mp3'); 
bgMusic.loop = true; bgMusic.volume = 0.5;
const bdaySong = new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_7314787968.mp3');
bdaySong.volume = 0.7;
const discoverySound = new Audio('https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3');
const explosionSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1105/1105-preview.mp3');

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const mmCtx = document.getElementById('mmCanvas').getContext('2d');
canvas.width = window.innerWidth; canvas.height = window.innerHeight;

let gameActive = false, isDialogOpen = false, dialogueCooldown = 0;
let friendsFound = 0, cakeExploded = false;
let particles = [], flowers = [];

const player = { x: 1250, y: 1250, speed: 7, color: '#ffed00', pulse: 0 };
const camera = { x: 1250, y: 1250 };
const keys = {};

const friends = [
    { name: "Kanishkaa", x: 400, y: 400, msg: "Happy Birthday to the one whoâ€™s not just my best friend but my elder sister by heart. You guide me, explain things no one has ever have and probably will never to me, and always look out for me. Iâ€™m so grateful to have you in my life. I will love you no matter what u are or who u are.. Always be yourself. Once again happy birthday! LOVE UU A LOOTT (pluto)... Hope u stay happy and healthy all the time.", photo: "kanish_together.webp", found: false, hasBeenRead: false },
    { name: "Aanya", x: 2100, y: 400, msg: "Heyy! Happy Birthday, Prarthna!! I hope this year brings you everything you wish for and more. Never stop being the amazing, kind and genuine person you are. You truly make people around you so happy. Have the most wonderful birthday ever!", photo: "aanya_together.jpg", found: false, hasBeenRead: false },
    { name: "Nishchita", x: 500, y: 1250, msgImg: "nish_message.png", photo: "nish_together.jpeg", found: false, hasBeenRead: false },
    { name: "Patrina", x: 400, y: 2100, msg: "Happy Birthday, Prarthna! I hope you have a wonderful day and an amazing year in the future. I hope you reach all your goals and wish you the best to complete all of your resolutions (this year's and next year's too). I hope you like your birthday gift though I had to give it to you early. Don't forget to have fun (especially with all the new games that came out). Happy Birthday once again!", photo: "patrina_together.jpg", found: false, hasBeenRead: false },
    { name: "Parthvi", x: 1250, y: 500, msg: "Happy 15 Micheal!! Youâ€™ve officially completed 15 years of breathing, how do you feel about this?! Youâ€™re gonna have many more fun filled years full of laughter, achievements and the most pleasant surprises because I said so. Have the best birthday and a merry Christmas!! I miss you loads and hope we can meet again after we get escape this asylum (10th grade). Have a good one!!", photo: "parthvi_together.jpg", found: false, hasBeenRead: false },
    { name: "Ananya", x: 2100, y: 2100, msg: "HI PRARTHNA!! Wishing you the happiest of birthdays! Hope you enjoy 15 and wishing you many more wonderful years. Enjoy your life to the fullest (and cheers to many wonderful years with you and many to look forward to). Happy Birthday again, son (I'm retiring michael jackson for reasons) ", photo: "ananya_together.jpg", found: false, hasBeenRead: false },
];

function showBriefing(num) {
    if(num === 1) {
        document.getElementById('splash-screen').style.display = 'none';
        document.getElementById('briefing-1').style.display = 'flex';
        bgMusic.play().catch(()=>{});
    } else {
        gameActive = false;
        document.getElementById('briefing-2').style.display = 'flex';
    }
}
function launchGame() {
    document.getElementById('briefing-1').style.display = 'none';
    document.getElementById('mini-map-container').style.display = 'block';
    document.getElementById('quest-tracker').style.display = 'block';
    gameActive = true; requestAnimationFrame(gameLoop);
}
function closeCakeBriefing() { document.getElementById('briefing-2').style.display = 'none'; gameActive = true; }
function showMemoryPhoto() { document.getElementById('view-message').style.display = 'none'; document.getElementById('view-photo').style.display = 'block'; }

function closeDialog() {
    isDialogOpen = false; 
    document.getElementById('ui').style.display = 'none'; 
    dialogueCooldown = 60;
    
    // Mark as fully read so it doesn't trigger again
    friends.forEach(f => {
        if(f.found && !f.hasBeenRead) f.hasBeenRead = true;
    });

    if (friendsFound === 6 && !cakeExploded) { showBriefing(2); }
}

window.addEventListener('keydown', e => keys[e.code] = true);
window.addEventListener('keyup', e => keys[e.code] = false);

class Confetti {
    constructor(x, y) {
        this.x = x; this.y = y;
        this.vx = (Math.random() - 0.5) * 20; this.vy = (Math.random() - 0.5) * 20;
        this.life = 100; this.color = `hsl(${Math.random()*360}, 100%, 50%)`;
    }
    update() { this.x += this.vx; this.y += this.vy; this.vy += 0.25; this.life -= 1; }
    draw() { ctx.fillStyle = this.color; ctx.globalAlpha = this.life/100; ctx.beginPath(); ctx.arc(this.x - camera.x, this.y - camera.y, 6, 0, Math.PI*2); ctx.fill(); ctx.globalAlpha = 1; }
}

function update() {
    if (!gameActive || isDialogOpen) return;
    if (dialogueCooldown > 0) dialogueCooldown--;
    if (keys['KeyW'] || keys['ArrowUp']) player.y -= player.speed;
    if (keys['KeyS'] || keys['ArrowDown']) player.y += player.speed;
    if (keys['KeyA'] || keys['ArrowLeft']) player.x -= player.speed;
    if (keys['KeyD'] || keys['ArrowRight']) player.x += player.speed;

    if (flowers.length < 150) flowers.push({ x: player.x + (Math.random()-0.5)*4000, y: player.y + (Math.random()-0.5)*4000, emoji: ["ðŸŒ¸", "ðŸ’—", "ðŸŒ·", "â¤ï¸"][Math.floor(Math.random()*4)], size: 22 });
    
    friends.forEach(f => {
        // Only trigger if it hasn't been read yet
        if (!f.hasBeenRead && dialogueCooldown <= 0 && Math.hypot(player.x - f.x, player.y - f.y) < 65) {
            isDialogOpen = true;
            document.getElementById('ui').style.display = 'block';
            document.getElementById('view-message').style.display = 'block';
            document.getElementById('view-photo').style.display = 'none';
            document.getElementById('speaker-name').innerText = f.name;
            const msgImg = document.getElementById('message-image');
            const msgTxt = document.getElementById('message-text');
            if(f.msgImg) { msgImg.src = f.msgImg; msgImg.style.display = 'block'; msgTxt.style.display = 'none'; }
            else { msgImg.style.display = 'none'; msgTxt.innerText = f.msg; msgTxt.style.display = 'block'; }
            document.getElementById('memory-image').src = f.photo;
            if (!f.found) { f.found = true; friendsFound++; discoverySound.play().catch(()=>{}); }
        }
    });

    if (friendsFound === 6 && !cakeExploded && Math.hypot(player.x - 1250, player.y - 1250) < 100) {
        cakeExploded = true; bgMusic.pause(); explosionSound.play(); bdaySong.play();
        for(let i=0; i<600; i++) particles.push(new Confetti(1250, 1250));
        setTimeout(() => { document.getElementById('end-screen').style.display = 'flex'; }, 6000);
    }
    particles.forEach((p, i) => { p.update(); if(p.life <= 0) particles.splice(i, 1); });
    camera.x += (player.x - canvas.width/2 - camera.x) * 0.1;
    camera.y += (player.y - canvas.height/2 - camera.y) * 0.1;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    flowers.forEach(f => { ctx.font = `${f.size}px Arial`; ctx.fillText(f.emoji, f.x-camera.x, f.y-camera.y); });
    
    friends.forEach(f => {
        if (f.hasBeenRead) return; // Hide bubble if already read
        const sx = f.x - camera.x, sy = f.y - camera.y;
        if (f.found) { 
            ctx.font = "40px Arial"; ctx.textAlign="center"; ctx.fillText("â¤ï¸", sx, sy + 15); 
            ctx.fillStyle = "white"; ctx.font = "bold 26px 'Satisfy'"; ctx.fillText(f.name, sx, sy - 50); 
        }
        else { 
            ctx.fillStyle = "rgba(0,0,0,0.5)"; ctx.beginPath(); ctx.arc(sx, sy, 25, 0, Math.PI*2); ctx.fill(); 
            ctx.fillStyle = "white"; ctx.font = "bold 22px Courier New"; 
            ctx.textAlign = "center"; ctx.textBaseline = "middle"; // Center the ? perfectly
            ctx.fillText("?", sx, sy); 
        }
    });

    ctx.textBaseline = "alphabetic"; // Reset baseline
    if (friendsFound === 6 && !cakeExploded) { ctx.shadowBlur = 20; ctx.shadowColor = "#ffed00"; ctx.font = "140px Arial"; ctx.textAlign="center"; ctx.fillText("ðŸŽ‚", 1250-camera.x, 1280-camera.y); ctx.shadowBlur = 0; }
    particles.forEach(p => p.draw());
    ctx.fillStyle = player.color; ctx.beginPath(); ctx.arc(player.x-camera.x, player.y-camera.y, 20, 0, Math.PI*2); ctx.fill();
    
    mmCtx.fillStyle = "black"; mmCtx.fillRect(0,0,150,150);
    friends.forEach(f => {
        if(f.hasBeenRead) return;
        mmCtx.fillStyle = f.found ? "#444" : "#ff4444"; mmCtx.beginPath(); mmCtx.arc((f.x/2500)*150, (f.y/2500)*150, 3, 0, Math.PI*2); mmCtx.fill(); 
    });
    if(friendsFound === 6) { mmCtx.font = "14px Arial"; mmCtx.textAlign = "center"; mmCtx.fillText("â­", 75, 80); }
    mmCtx.fillStyle = "yellow"; mmCtx.fillRect((player.x/2500)*150-2, (player.y/2500)*150-2, 4, 4);
    if (cakeExploded) { ctx.font = "bold 70px 'Satisfy'"; ctx.textAlign="center"; ctx.fillStyle="white"; ctx.fillText("Happy Birthday Prarthna!", canvas.width/2, canvas.height/2); }
}
function gameLoop() { update(); draw(); requestAnimationFrame(gameLoop); }
window.addEventListener('resize', () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; });
</script>
</body>
</html>